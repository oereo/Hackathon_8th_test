{% extends 'base.html' %}
{% block title %}Restaurant Page{% endblock %}
{% block content %}
{% load static %}


<link rel="stylesheet" href="{% static 'css/product_list.css' %}"/>

<style>
    #restaurantfont {
        font-size: 180%;
        font-weight: bold;
    }
    #restaurant_location {
        font-size: 180%;
        font-weight: bold;
    }    
    #green {
        font-weight: bold;
        color: #00be68
    }
    #red {
        font-weight: bold;
        color: red;
    }
    th, td {
        padding: 10px;
    }
</style>

<!-- <div class="box-container"> -->

    <div class="store" id="box-layout" style="margin: 50px 0px 50px 0px; background-color: white">

    <div class="store-in">

        <div class="storepic">
            <div class="card-image"><img style="max-width: 100%" src="{{current_restaurant.image.url}}"></div>
        </div>

        <div class="storeinfo">
            <p id="restaurantfont">{{current_restaurant.name}}</p>
            <p>거리 | 500m 이내</p>
            <p>지도 | <a href="#restaurant_location" style="color:black" >위치보기</a></p>
            <!-- <p>별별별별별 4.7</p> -->
        </div>

    </div>

</div>

<div style="margin-bottom:50px;">

    <p><span id="restaurantfont">오늘의 상품</span><span style="float: right;">오늘 판매하는 상품만 등록합니다.</span></p>

    <!-- Up to 3 menus -->
    {% for product in products %}

    <div class="menu-in" id="box-layout" style="background-color: white">

        <div class="menupic">
            <p class="text-center">
                <img class="card-img-top" src="{{product.image.url}}" alt="restaurant Image"
                     style=" height: 150px;width: 150px; ">
            </p>
        </div>

        <div class="menuinfo">
            <ul style="list-style: none;">
                <li id="restaurantfont">{{product.name}}</li>
                <li><span id="green">정가 : {{product.origin_price}}원 </span> → <span
                    id="red">할인가격 : {{product.price}}원 </span></li>
                <li id="green" style="margin-top:10px;">할인율 {{product.discount|floatformat:"0"}} %</li>
                <div onload="boxlayout()">
                    <li id="result"></li>
                </div>

            </ul>
        </div>

        <div class="cartbutton">
            <form action="{% url 'cart:product_add' product.id  %}" method="post">
                {{add_to_cart}}
                {% csrf_token %}
                <input type="submit" class="btn btn-success btn-sm" value="카트 추가" style="margin-top:20px;">
            </form>
        </div>

    </div>
    {% endfor %}

</div>

<div style="margin-bottom:50px;">
    <table class="table table-hover">
        <thead>
        <tr>
            <th>날짜</th>
            <th>댓글</th>
            <th>작성자</th>
            <th>댓글삭제</th>
        </tr>
        </thead>
        <tbody>
        {% for post in page_posts %}
        <tr>
            <td id="blog_date">{{post.pub_date}}</td>
            <td id="blog_title" style="width : 500px;">{{post.body}}</td>
            <td id="blog_owner">{{post.owner}}</td>
            <td>
                <button class = "btn btn-success"onclick="location.href='{% url 'shop:deletecomment' post.id %}'">삭제하기</button>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    <div class="paginator" style="text-align: center">
        {% if page_posts.has_previous %}
        <a href="?page=1">First</a>
        <a href="?page={{page_posts.previous_page_number}}">Previous</a>
        {% endif %}
        <span>{{page_posts.number}}</span>
        <span>of<span>
                    <span>{{page_posts.paginator.num_pages}}</span>

                {% if page_posts.has_next %}
                    <a href="?page={{page_posts.next_page_number}}">Next</a>
                    <a href="?page={{page_posts.paginator.num_pages}}">Last</a>
                {% endif %}
    </div>
    <form method="POST">
        {% csrf_token %}

        <h4>댓글 달기</h4>
        <div class = "row">
            <div class = "col-sm-11">
                <textarea id="newpost_body" cols=120 rows=2 name="body" style="width : 100%"></textarea>
            </div>
            <div class = "col-sm-1">
                <input style=" text-align: right;" class="btn btn-dark" type="submit" value="제출">
            </div>
        </div>


    </form>
</div>

<div class="storelocation" id="margin" style="margin-bottom:50px;">

    <p><span id="restaurant_location">매장 위치</span></p>

    <!-- for map -->
    <div id="map" style="width:100%;height:500px;"></div>


</div>

<div class="storeinfo" style="margin-bottom:50px; " >

    <p><span id="restaurantfont">매장 정보</span></p>

    <div id="box-layout" style="background-color: white">

        <table>

            <colgroup>
                <col width="35%"/>
                <col width="*"/>
            </colgroup>

            <tr>
                <td>영업시간</td>
                <td>{{current_restaurant.open_time}}</td>
            </tr>

            <tr>
                <td>전화번호</td>
                <td>{{current_restaurant.call_number}}</td>
            </tr>

            <tr>
                <td>주소</td>
                <td>
                    <div id="address">{{current_restaurant.location}}</div>
                </td>
            </tr>

        </table>

    </div>

</div>

<div class="storeowner" style="margin-bottom:50px;">

    <p><span id="restaurantfont">사업자 정보</span></p>

    <div id="box-layout" style="background-color: white">

        <table>

            <colgroup>
                <col width="45%"/>
                <col width="*"/>
            </colgroup>

            <tr>
                <td>상호명</td>
                <td>{{current_restaurant.name}}</td>
            </tr>

            <tr>
                <td>사업자등록번호</td>
                <td>{{current_restaurant.business_number}}</td>
            </tr>

        </table>

    </div>

</div>

<div class="foodinfo" style="margin-bottom:50px;">

    <p><span id="restaurantfont">원산지 정보</span></p>

    <div id="box-layout" style="background-color: white">
        <p>{{current_restaurant.food_origin}}</p>
    </div>

</div>

<!-- </div> -->

<script>
    function boxlayout() {
        var origin_price = document.getElementById("red").innerHTML;
        var price = document.getElementById("green").innerHTML
        result = parseInt(origin_price) / parseInt(price)
        document.getElementById("result").innerHTML = result
    }


</script>

<script>
    var address = document.getElementById("address").innerHTML;

    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
        mapOption = {
            center: new kakao.maps.LatLng(127.140083, 37.4676097), // 지도의 중심좌표
            level: 3 // 지도의 확대 레벨
        };

    // 지도를 생성합니다
    var map = new kakao.maps.Map(mapContainer, mapOption);

    // 주소-좌표 변환 객체를 생성합니다
    var geocoder = new kakao.maps.services.Geocoder();

    // 주소로 좌표를 검색합니다
    geocoder.addressSearch(address, function (result, status) {

        // 정상적으로 검색이 완료됐으면
        if (status === kakao.maps.services.Status.OK) {

            var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

            // 결과값으로 받은 위치를 마커로 표시합니다
            var marker = new kakao.maps.Marker({
                map: map,
                position: coords
            });

            // 인포윈도우로 장소에 대한 설명을 표시합니다
            var infowindow = new kakao.maps.InfoWindow({
                content: '<div style="width:150px;text-align:center;padding:6px 0;">우리회사</div>'
            });
            infowindow.open(map, marker);

            // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
            map.setCenter(coords);
        }
    });

</script>

{% endblock %}
